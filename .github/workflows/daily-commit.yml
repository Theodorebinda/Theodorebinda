name: Fun Daily Commit ğŸš€

on:
  schedule:
    - cron: '0 2 * * *' # Tous les jours Ã  minuit UTC
  workflow_dispatch:

jobs:
  daily_fun:
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ›ï¸ Checkout du dÃ©pÃ´t
        uses: actions/checkout@v4
        with:
          persist-credentials: true
          fetch-depth: 0

      - name: ğŸ“¦ Installer jq
        run: sudo apt-get update && sudo apt-get install -y jq

      - name: âš™ï¸ Configurer Git
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"

      - name: ğŸ”„ Tirer les derniÃ¨res modifications
        run: git pull origin main --rebase

      - name: âœï¸ GÃ©nÃ©rer et insÃ©rer la citation dans README
        run: |
          set +e

          # Compteur basÃ© sur README
          if grep -q "Jour [0-9]\+" README.md; then
            last_count=$(grep -oE 'Jour [0-9]+' README.md | tail -n 1 | grep -oE '[0-9]+' || echo 0)
            count=$((last_count + 1))
          else
            count=1
          fi

          # Emojis
          emojis=("ğŸš€" "ğŸ”¥" "ğŸŒ" "ğŸ‰" "âœ¨" "ğŸŒˆ" "ğŸ’¡" "ğŸ§ " "ğŸŒ" "ğŸ’»" "â˜•" "ğŸ“š" "ğŸŒ±")
          emoji=${emojis[$((RANDOM % ${#emojis[@]}))]}

          # Citation (fallback si API KO)
          quote=$(curl -s https://api.quotable.io/random | jq -r '.content + " â€” " + .author' || echo "Reste motivÃ© et continue â€” Inconnu")

          # Texte Ã  insÃ©rer
          new_block="<!--START_QUOTE-->\nJour $count $emoji - $(date '+%d %B %Y')\n\nğŸ’¬ \"$quote\"\n<!--END_QUOTE-->"

          # Remplacer dans README
          sed -i "/<!--START_QUOTE-->/, /<!--END_QUOTE-->/c$new_block" README.md

      - name: ğŸ’¾ Commit & Push
        run: |
          git add README.md
          git commit -m "âœ¨ Jour $count - Mise Ã  jour citation quotidienne" || echo "Rien Ã  committer"
          git push origin main
