name: Fun Daily Commit 🚀

on:
  schedule:
    - cron: '0 0 * * *' # Tous les jours à minuit UTC
  workflow_dispatch:

jobs:
  daily_fun:
    runs-on: ubuntu-latest

    steps:
      - name: 🛎️ Checkout du dépôt
        uses: actions/checkout@v4
        with:
          persist-credentials: true
          fetch-depth: 0

      - name: 📦 Installer jq
        run: sudo apt-get update && sudo apt-get install -y jq

      - name: ⚙️ Configurer Git
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"

      - name: 🔄 Tirer les dernières modifications
        run: git pull origin main --rebase

      - name: ✍️ Générer une citation avec emoji et compteur
        run: |
          # Déterminer le compteur
          if [ -f "activity.log" ]; then
            last_count=$(grep -oE 'Jour [0-9]+' activity.log | tail -n 1 | grep -oE '[0-9]+' || echo 0)
            count=$((last_count + 1))
          else
            count=1
          fi

          # Liste d'emojis
          emojis=("🚀" "🔥" "🌞" "🎉" "✨" "🌈" "💡" "🧠" "🌍" "💻" "☕" "📚" "🌱")
          emoji=${emojis[$((RANDOM % ${#emojis[@]}))]}

          # Récupérer une citation depuis l'API (si échec → valeur par défaut)
          quote=$(curl -s https://api.quotable.io/random | jq -r '.content + " — " + .author' || echo "Reste motivé et continue d'apprendre — Inconnu")

          # Ajouter au fichier (append)
          {
            echo "Jour $count $emoji - $(date)"
            echo ""
            echo "💬 \"$quote\""
            echo ""
          } >> activity.log

      - name: 💾 Commit & Push
        run: |
          git add activity.log
          git commit -m "✨ Jour $count - Inspiration quotidienne" || echo "Rien à committer"
          git push origin main
